!function(){"use strict";new class{constructor(){this.load().then(this.showResults.bind(this))}load(){return fetch("/wp-admin/admin-ajax.php?action=get_shlinks")}async showResults(t){let e=await t.json(),i="Oops, something unexpected happened";i=e.ok?this.getListHTML(e.shlink.shortUrls.data):"Error: "+(e.error||"mystery error");let l=document.querySelector(".shlink-manager");l.innerHTML=i,l.addEventListener("click",this.clickHandler.bind(this)),document.querySelector(".shlink-create").addEventListener("submit",this.createShlink.bind(this))}getListHTML(t){let e='<ul class="shlink-list">';for(let i of t)e+=this.getItemHTML(i);return e+="</ul>",e}getItemHTML(t){return`<li class="shlink-item"${this.getItemDataAttrs(t)}>\n\t\t\t${this.getItemContentHTML(t)}\n\t\t</li>`}getItemDataAttrs(t){let e="";return e+=` data-title="${this.escape(t.title)}"`,e+=` data-long-url="${this.escape(t.longUrl)}"`,e+=` data-short-url="${this.escape(t.shortUrl)}"`,e+=` data-short-code="${this.escape(t.shortCode)}"`,e}getItemContentHTML(t){return`<div class="shlink-item__content">\n\t\t\t<div class="shlink-long-url">${t.title||t.longUrl}</div>\n\t\t\t<div class="shlink-short-url">${t.shortUrl}</a>\n\t\t</div>`}async createShlink(t){t.preventDefault();let e=t.target.getAttribute("action"),i=document.querySelector("input.shlink-long-url"),l=await fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:this.encodeFormData({action:"create_shlink",long_url:i.value})});i.value="";let n=await l.json(),s=document.querySelector(".shlink-list");s.innerHTML=this.getItemHTML(n.shlink)+s.innerHTML;let a=s.querySelectorAll(".shlink-item");this.editShlink(a[0])}clickHandler(t){var e;if(t.target.classList.contains("button"))return;if(t.target.classList.contains("shlink-item"))e=t.target;else{if(!t.target.closest(".shlink-item"))return!0;e=t.target.closest(".shlink-item")}let i=document.querySelector(".shlink-item--is-editing");i&&i.classList.remove("shlink-item--is-editing"),this.editShlink(e)}editShlink(t){var e;if(t.classList.add("shlink-item--is-editing"),t.querySelector(".shlink-item__edit"))e=t.querySelector(".shlink-item__edit");else{let i=t.getAttribute("data-short-url"),l=t.getAttribute("data-short-code"),n=new RegExp(`${l}$`),s=i.replace(n,"");(e=t.appendChild(document.createElement("form"))).setAttribute("action","/wp-admin/admin-ajax.php"),e.setAttribute("method","POST"),e.classList.add("shlink-item__edit"),e.innerHTML=`\n\t\t\t\t<div class="shlink-edit-field">\n\t\t\t\t\t<label for="shlink-edit-title" class="shlink-label">Title</label>\n\t\t\t\t\t<input type="text" id="shlink-edit-title" name="title" class="shlink-edit-title regular-text ltr" value="${t.getAttribute("data-title")}">\n\t\t\t\t</div>\n\t\t\t\t<div class="shlink-edit-field">\n\t\t\t\t\t<label for="shlink-edit-long-url" class="shlink-label">Long URL</label>\n\t\t\t\t\t<input type="text" id="shlink-edit-long-url" name="long_url" class="shlink-edit-long-url regular-text ltr" value="${t.getAttribute("data-long-url")}">\n\t\t\t\t</div>\n\t\t\t\t<div class="shlink-edit-field">\n\t\t\t\t\t<label for="shlink-edit-short-code" class="shlink-label">Short URL</label>\n\t\t\t\t\t<span class="shlink-edit-prefix">${s}</span><input type="text" id="shlink-edit-short-code" name="short_code" class="shlink-edit-short-code regular-text ltr" value="${t.getAttribute("data-short-code")}">\n\t\t\t\t</div>\n\t\t\t\t<div class="shlink-edit-buttons">\n\t\t\t\t\t<input type="submit" value="Save" class="shlink-save button button-primary">\n\t\t\t\t\t<input type="button" value="Cancel" class="shlink-cancel button">\n\t\t\t\t</div>\n\t\t\t`,e.addEventListener("submit",this.saveShlink.bind(this)),e.querySelector(".shlink-cancel").addEventListener("click",(t=>{t.preventDefault(),t.target.closest(".shlink-item").classList.remove("shlink-item--is-editing")}))}}async saveShlink(t){t.preventDefault();let e=t.target.closest(".shlink-item"),i=e.querySelector(".shlink-edit-title").value,l=e.querySelector(".shlink-edit-long-url").value,n=e.querySelector(".shlink-edit-short-code").value;e.setAttribute("data-title",i),e.setAttribute("data-long-url",l),e.setAttribute("data-short-code",n);let s=await fetch("/wp-admin/admin-ajax.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:this.encodeFormData({action:"update_shlink",title:i,long_url:l,short_code:n})}),a=await s.json();a.ok&&(e.classList.remove("shlink-item--is-editing"),e.innerHTML=this.getItemContentHTML(a.shlink))}encodeFormData(t){return Object.keys(t).map((e=>`${e=encodeURIComponent(e)}=${encodeURIComponent(t[e])}`)).join("&")}escape(t){return t?(""+t).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}}}();