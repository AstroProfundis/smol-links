!function(){"use strict";new class{constructor(){this.load().then(this.showResults.bind(this))}load(){return fetch("/wp-admin/admin-ajax.php?action=get_shlinks")}async showResults(t){let e=await t.json(),i="Oops, something unexpected happened";i=e.ok?this.getListHTML(e.shlink.shortUrls.data):"Error: "+(e.error||"mystery error");let s=document.querySelector(".shlink-manager");s.innerHTML=i,s.addEventListener("click",this.clickHandler.bind(this)),document.querySelector(".shlink-create").addEventListener("submit",this.createShlink.bind(this))}getListHTML(t){let e='<ul class="shlink-list">';for(let i of t)e+=this.getItemHTML(i);return e+="</ul>",e}getItemHTML(t){return`<li class="shlink-item"${this.getItemDataAttrs(t)}>\n\t\t\t${this.getItemContentHTML(t)}\n\t\t</li>`}getItemDataAttrs(t){let e="";return e+=` data-title="${this.escape(t.title)}"`,e+=` data-long-url="${this.escape(t.longUrl)}"`,e+=` data-short-url="${this.escape(t.shortUrl)}"`,e+=` data-short-code="${this.escape(t.shortCode)}"`,e}getItemContentHTML(t){let e=t.title||t.longUrl;return`<div class="shlink-item__content">\n\t\t\t<div class="shlink-item__clicks">\n\t\t\t\t${t.visitsCount} clicks\n\t\t\t</div>\n\t\t\t<div class="shlink-item__links">\n\t\t\t\t<div class="shlink-item__long-url">${e}</div>\n\t\t\t\t<div class="shlink-item__short-url">${t.shortUrl}</div>\n\t\t\t\t<div class="shlink-loading">\n\t\t\t\t\t<span class="shlink-loading-dot shlink-loading-dot--1"></span>\n\t\t\t\t\t<span class="shlink-loading-dot shlink-loading-dot--2"></span>\n\t\t\t\t\t<span class="shlink-loading-dot shlink-loading-dot--3"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>`}async createShlink(t){t.preventDefault();let e=t.target.getAttribute("action"),i=document.querySelector("input.shlink-long-url"),s=document.querySelector(".shlink-list");s.innerHTML=this.getItemHTML({longUrl:i.value,shortCode:"",shortUrl:"",visitsCount:0})+s.innerHTML;let l=s.querySelectorAll(".shlink-item")[0];l.classList.add("shlink-item--is-saving");let n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:this.encodeFormData({action:"create_shlink",long_url:i.value})});i.value="";let a=await n.json();l.innerHTML=this.getItemContentHTML(a.shlink),l.classList.remove("shlink-item--is-saving"),l.setAttribute("data-title",a.shlink.title||""),l.setAttribute("data-short-code",a.shlink.shortCode),l.setAttribute("data-short-url",a.shlink.shortUrl)}clickHandler(t){var e;if(!t.target.classList.contains("button")){if(t.target.classList.contains("shlink-item"))e=t.target;else{if(!t.target.closest(".shlink-item"))return!0;e=t.target.closest(".shlink-item")}this.editShlink(e)}}editShlink(t){let e=document.querySelector(".shlink-item--is-editing");var i;if(e&&e.classList.remove("shlink-item--is-editing"),t.classList.add("shlink-item--is-editing"),t.querySelector(".shlink-item__edit"))i=t.querySelector(".shlink-item__edit");else{let e=t.getAttribute("data-short-url"),s=t.getAttribute("data-short-code"),l=new RegExp(`${s}$`),n=e.replace(l,"");(i=t.appendChild(document.createElement("form"))).setAttribute("action","/wp-admin/admin-ajax.php"),i.setAttribute("method","POST"),i.classList.add("shlink-item__edit"),i.innerHTML=`\n\t\t\t\t<div class="shlink-edit-field">\n\t\t\t\t\t<label for="shlink-edit-title" class="shlink-label">Title</label>\n\t\t\t\t\t<input type="text" id="shlink-edit-title" name="title" class="shlink-edit-title regular-text ltr" value="${t.getAttribute("data-title")}">\n\t\t\t\t</div>\n\t\t\t\t<div class="shlink-edit-field">\n\t\t\t\t\t<label for="shlink-edit-long-url" class="shlink-label">Long URL</label>\n\t\t\t\t\t<input type="text" id="shlink-edit-long-url" name="long_url" class="shlink-edit-long-url regular-text ltr" value="${t.getAttribute("data-long-url")}">\n\t\t\t\t</div>\n\t\t\t\t<div class="shlink-edit-field">\n\t\t\t\t\t<label for="shlink-edit-short-code" class="shlink-label">Short URL</label>\n\t\t\t\t\t<span class="shlink-edit-prefix">${n}</span><input type="text" id="shlink-edit-short-code" name="short_code" class="shlink-edit-short-code regular-text ltr" value="${t.getAttribute("data-short-code")}">\n\t\t\t\t</div>\n\t\t\t\t<div class="shlink-edit-buttons">\n\t\t\t\t\t<input type="submit" value="Save" class="shlink-save button button-primary">\n\t\t\t\t\t<input type="button" value="Cancel" class="shlink-cancel button">\n\t\t\t\t</div>\n\t\t\t`,i.addEventListener("submit",this.saveShlink.bind(this)),i.querySelector(".shlink-cancel").addEventListener("click",(t=>{t.preventDefault(),t.target.closest(".shlink-item").classList.remove("shlink-item--is-editing")}))}}async saveShlink(t){console.log("saveShlink"),t.preventDefault();let e=t.target.closest(".shlink-item"),i=e.querySelector(".shlink-edit-title").value,s=e.querySelector(".shlink-edit-long-url").value,l=e.querySelector(".shlink-edit-short-code").value;e.classList.remove("shlink-item--is-editing"),e.classList.add("shlink-item--is-saving");let n=await fetch("/wp-admin/admin-ajax.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:this.encodeFormData({action:"update_shlink",title:i,long_url:s,short_code:l})}),a=await n.json();if(a&&a.ok&&a.shlink){let t=a.shlink;if(200==t.status)return e.innerHTML=this.getItemContentHTML(a.shlink),e.classList.remove("shlink-item--is-saving"),e.setAttribute("data-title",i),e.setAttribute("data-long-url",s),e.setAttribute("data-short-code",l),e.querySelector(".shlink-item__long-url").innerHTML=i||s,!0;if(e.classList.add("shlink-item--is-editing"),e.classList.remove("shlink-item--is-saving"),t.title&&t.detail)return alert(`Error: ${t.title}. ${t.detail}.`),!1}return alert("Sorry, there was a problem saving changes to the Shlink."),!1}encodeFormData(t){return Object.keys(t).map((e=>`${e=encodeURIComponent(e)}=${encodeURIComponent(t[e])}`)).join("&")}escape(t){return t?(""+t).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}}}();